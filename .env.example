# =============================================================================
# ROFL Price Oracle - Off-Chain Aggregation Configuration
# =============================================================================
#
# This oracle aggregates prices from multiple off-chain sources using median
# calculation with outlier detection, then submits to on-chain aggregator contracts.
#
# Architecture:
#   Multiple APIs → Median Aggregation → On-Chain Submission
#   (Coinbase, Kraken, CoinGecko, etc.) → median → Aggregator Contract
#
# =============================================================================

# -----------------------------------------------------------------------------
# Trading Pairs
# -----------------------------------------------------------------------------
# Comma-separated list of trading pairs to track.
# Format: base/quote (e.g., btc/usd, eth/usd, rose/usd)
PAIRS=usdt/usd,rose/usd

# -----------------------------------------------------------------------------
# Price Sources
# -----------------------------------------------------------------------------
# Comma-separated list of price sources to query.
# Available sources:
#   - coinbase      (free, native USD, supports ROSE)
#   - kraken        (free, native USD, no ROSE)
#   - bitstamp      (free, native USD, no ROSE)
#   - coingecko     (free, supports all including ROSE)
#   - coinmarketcap (requires API key, supports all including ROSE)
#   - coinapi       (requires API key, professional grade)
#   - eodhd         (requires API key, USD pairs only)
#   - bitquery      (requires API key, GraphQL-based)
#   - binance       (free, USDT pairs, auto-adds usdt/usd pair for conversion)
#   - coinpaprika   (free, supports ROSE)
#   - cryptocompare (free, supports all)
#
# NOTE: When 'binance' is in sources, a 'usdt/usd' pair is automatically added
# to fetch the USDT/USD exchange rate from other sources.
SOURCES=coinbase,kraken,coingecko,binance,coinpaprika,cryptocompare

# -----------------------------------------------------------------------------
# Aggregation Parameters
# -----------------------------------------------------------------------------
# Minimum number of sources that must return valid prices.
# If fewer sources respond, no price update is submitted.
MIN_SOURCES=2

# Maximum deviation from median (%) before a source is excluded as an outlier.
# Example: If median is $100 and MAX_DEVIATION_PERCENT=5, prices outside
# $95-$105 range are excluded.
MAX_DEVIATION_PERCENT=5.0

# Maximum allowed change (%) vs previous round's price.
# Prevents sudden large price swings from being submitted.
# Set to 0 to disable drift limiting.
DRIFT_LIMIT_PERCENT=10.0

# -----------------------------------------------------------------------------
# Timing Configuration
# -----------------------------------------------------------------------------
# Seconds between fetching prices from all sources.
# Lower = more frequent updates, but more API calls.
FETCH_PERIOD=60

# Seconds between on-chain submissions.
# Multiple observations are accumulated and their median is submitted.
# NOTE: SUBMIT_PERIOD < 300 (5 min) may exceed CoinMarketCap free tier limit.
SUBMIT_PERIOD=300

# Timeout for individual fetch requests (seconds).
FETCH_TIMEOUT=10.0

# -----------------------------------------------------------------------------
# Network Configuration
# -----------------------------------------------------------------------------
# Oasis network to connect to.
# Options: sapphire, sapphire-testnet, sapphire-localnet
NETWORK=sapphire-testnet

# Address of PriceFeedDirectory contract.
# Defaults per network:
#   - sapphire-testnet:  0xB3E8721A5E9bb84Cfa99b50131Ac47341B4a9EfF (pre-deployed)
#   - sapphire-localnet: 0x5FbDB2315678afecb367f032d93F642f64180aa3 (if using production contracts)
#   - sapphire:          (none - must be provided)
#
# For local testing with mock contracts, deploy MockPriceFeedDirectory first:
#   cd contracts && forge script script/DeployMocks.s.sol --rpc-url sapphire-localnet --broadcast
# Then set PRICE_FEED_ADDRESS to the deployed address.
# PRICE_FEED_ADDRESS=

# (Optional) Comma-separated aggregator contract addresses.
# If not provided, contracts are auto-detected/deployed via PriceFeedDirectory.
# ADDRESS=

# -----------------------------------------------------------------------------
# API Keys
# -----------------------------------------------------------------------------
# API keys can be provided in two ways:
# 1. Individual environment variables: API_KEY_<SOURCE>=<key>
# 2. Comma-separated string: API_KEYS=source1=key1,source2=key2
#
# Required for:
#   - coinmarketcap (free tier: 333 calls/day)
#   - coinapi (paid, $25 free credits)
#   - eodhd (paid)
#   - bitquery (paid)
#
# Optional (increases rate limits):
#   - coingecko (free tier: 30 calls/min)

# CoinGecko API key (optional, increases rate limit)
# API_KEY_COINGECKO=

# CoinMarketCap API key (required if using coinmarketcap source)
# Free tier: 333 calls/day - sufficient for SUBMIT_PERIOD=300 (5 min)
# API_KEY_COINMARKETCAP=

# CoinAPI key (required if using coinapi source)
# API_KEY_COINAPI=

# EODHD API key (required if using eodhd source)
# API_KEY_EODHD=

# Bitquery API key (required if using bitquery source)
# API_KEY_BITQUERY=

# -----------------------------------------------------------------------------
# Recommended Production Configuration (with ROSE/USD support)
# -----------------------------------------------------------------------------
# PAIRS=btc/usd,eth/usd,rose/usd
# SOURCES=coinbase,kraken,coingecko,binance,coinpaprika,cryptocompare
# MIN_SOURCES=2
# MAX_DEVIATION_PERCENT=5.0
# DRIFT_LIMIT_PERCENT=10.0
# FETCH_PERIOD=60
# SUBMIT_PERIOD=300
# NETWORK=sapphire-testnet
#
# ROSE/USD Coverage:
#   - Coinbase (native USD support)
#   - CoinGecko (id: oasis-network)
#   - Coinpaprika (id: rose-oasis-network)
#   - CryptoCompare
#   = 4 sources for redundancy
#
# USDT/USD (auto-added when binance is in sources):
#   - CoinGecko, Kraken, Coinpaprika, CryptoCompare
#   = 4 sources for accurate USDT conversion
