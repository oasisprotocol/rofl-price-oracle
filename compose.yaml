services:
  oracle:
    build:
      dockerfile: ./Dockerfile.oracle
    image: "ghcr.io/rube-de/rofl-price-oracle"
    platform: linux/amd64
    restart: on-failure
    environment:
      # Core configuration (all have sensible defaults in oracle/main.py)
      - NETWORK=${NETWORK}
      - PAIRS=${PAIRS}
      - SOURCES=${SOURCES}
      - MIN_SOURCES=${MIN_SOURCES}
      - MAX_DEVIATION_PERCENT=${MAX_DEVIATION_PERCENT}
      - DRIFT_LIMIT_PERCENT=${DRIFT_LIMIT_PERCENT}
      - FETCH_PERIOD=${FETCH_PERIOD}
      - SUBMIT_PERIOD=${SUBMIT_PERIOD}
      - FETCH_TIMEOUT=${FETCH_TIMEOUT}
      # Optional addresses (oracle will auto-detect/deploy if unset)
      - PRICE_FEED_ADDRESS=${PRICE_FEED_ADDRESS}
      - ADDRESS=${ADDRESS}
      # API keys: either individual API_KEY_* or aggregated API_KEYS
      - API_KEYS=${API_KEYS}
      - API_KEY_COINGECKO=${API_KEY_COINGECKO}
      - API_KEY_COINMARKETCAP=${API_KEY_COINMARKETCAP}
      - API_KEY_COINAPI=${API_KEY_COINAPI}
      - API_KEY_EODHD=${API_KEY_EODHD}
      - API_KEY_BITQUERY=${API_KEY_BITQUERY}
    volumes:
      - /run/rofl-appd.sock:/run/rofl-appd.sock
